# Dobby App Architecture

## High-Level Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         Dobby App                            â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚  â”‚   View   â”‚  â”‚   Scan   â”‚  â”‚  Dobby   â”‚                  â”‚
â”‚  â”‚   Tab    â”‚  â”‚   Tab    â”‚  â”‚   Tab    â”‚                  â”‚
â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚       â”‚             â”‚                                        â”‚
â”‚       â”‚      â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”                                â”‚
â”‚       â”‚      â”‚  Receipt    â”‚                                â”‚
â”‚       â”‚      â”‚  Scanning   â”‚                                â”‚
â”‚       â”‚      â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                                â”‚
â”‚       â”‚             â”‚                                        â”‚
â”‚       â”‚      â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                            â”‚
â”‚       â”‚      â”‚   Camera        â”‚                            â”‚
â”‚       â”‚      â”‚   Photo Library â”‚                            â”‚
â”‚       â”‚      â”‚   Text Paste    â”‚                            â”‚
â”‚       â”‚      â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                            â”‚
â”‚       â”‚             â”‚                                        â”‚
â”‚       â”‚      â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                            â”‚
â”‚       â”‚      â”‚  Vision OCR     â”‚                            â”‚
â”‚       â”‚      â”‚  Store Detectionâ”‚                            â”‚
â”‚       â”‚      â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                            â”‚
â”‚       â”‚             â”‚                                        â”‚
â”‚       â”‚      â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                            â”‚
â”‚       â”‚      â”‚  Anthropic API  â”‚ â† AI Categorization        â”‚
â”‚       â”‚      â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                            â”‚
â”‚       â”‚             â”‚                                        â”‚
â”‚       â”‚      â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                            â”‚
â”‚       â”‚      â”‚ Review & Edit   â”‚                            â”‚
â”‚       â”‚      â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                            â”‚
â”‚       â”‚             â”‚                                        â”‚
â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                            â”‚
â”‚                                  â”‚                           â”‚
â”‚                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
â”‚                          â”‚ Transaction    â”‚                 â”‚
â”‚                          â”‚ Manager        â”‚                 â”‚
â”‚                          â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
â”‚                                  â”‚                           â”‚
â”‚                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
â”‚                          â”‚ Store          â”‚                 â”‚
â”‚                          â”‚ DataManager    â”‚                 â”‚
â”‚                          â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
â”‚                                  â”‚                           â”‚
â”‚                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
â”‚                          â”‚ Visualizations â”‚                 â”‚
â”‚                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Data Flow Diagram

```
User Action (Scan/Import)
        â”‚
        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ReceiptScanView   â”‚ â† User chooses import method
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ReceiptImportService               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ importReceipt(from: image)  â”‚   â”‚
â”‚  â”‚ or                          â”‚   â”‚
â”‚  â”‚ importReceipt(from: text)   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚             â”‚                       â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚   â”‚ Vision Framework   â”‚           â”‚
â”‚   â”‚ Extract Text       â”‚           â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚             â”‚                       â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚   â”‚ Detect Store       â”‚           â”‚
â”‚   â”‚ (keyword matching) â”‚           â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚             â”‚                       â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚   â”‚ Extract Date       â”‚           â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  AnthropicService                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ categorizeReceiptItems()     â”‚  â”‚
â”‚  â”‚                              â”‚  â”‚
â”‚  â”‚ 1. Build prompt              â”‚  â”‚
â”‚  â”‚ 2. Send to Claude API        â”‚  â”‚
â”‚  â”‚ 3. Parse JSON response       â”‚  â”‚
â”‚  â”‚ 4. Return categorized items  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ReceiptImportResult                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ â€¢ storeName                  â”‚  â”‚
â”‚  â”‚ â€¢ detectedStore              â”‚  â”‚
â”‚  â”‚ â€¢ date                       â”‚  â”‚
â”‚  â”‚ â€¢ transactions[]             â”‚  â”‚
â”‚  â”‚   - itemName                 â”‚  â”‚
â”‚  â”‚   - category                 â”‚  â”‚
â”‚  â”‚   - amount                   â”‚  â”‚
â”‚  â”‚   - quantity                 â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ReceiptReviewView                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ User can:                    â”‚  â”‚
â”‚  â”‚ â€¢ View all items             â”‚  â”‚
â”‚  â”‚ â€¢ Edit store/date            â”‚  â”‚
â”‚  â”‚ â€¢ Delete items               â”‚  â”‚
â”‚  â”‚ â€¢ See totals                 â”‚  â”‚
â”‚  â”‚ â€¢ Save or Cancel             â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â†“ (User taps Save)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  TransactionManager                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ addTransactions()            â”‚  â”‚
â”‚  â”‚ â€¢ Append to transactions[]   â”‚  â”‚
â”‚  â”‚ â€¢ Sort by date               â”‚  â”‚
â”‚  â”‚ â€¢ Trigger @Published update  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  StoreDataManager                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ regenerateBreakdowns()       â”‚  â”‚
â”‚  â”‚ â€¢ Group by store & period    â”‚  â”‚
â”‚  â”‚ â€¢ Calculate categories       â”‚  â”‚
â”‚  â”‚ â€¢ Update breakdowns[]        â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  OverviewView                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ â€¢ Displays store breakdowns  â”‚  â”‚
â”‚  â”‚ â€¢ Shows charts               â”‚  â”‚
â”‚  â”‚ â€¢ Filters & sorts            â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## File Structure & Responsibilities

```
Dobby/
â”‚
â”œâ”€â”€ App Entry
â”‚   â”œâ”€â”€ DobbyApp.swift           # @main entry point
â”‚   â””â”€â”€ ContentView.swift        # Tab container + TransactionManager
â”‚
â”œâ”€â”€ Configuration
â”‚   â””â”€â”€ env.swift                # API keys and config
â”‚
â”œâ”€â”€ Models
â”‚   â”œâ”€â”€ TransactionModel.swift
â”‚   â”‚   â”œâ”€â”€ Transaction          # Single transaction
â”‚   â”‚   â””â”€â”€ TransactionManager   # CRUD operations, @Published
â”‚   â”‚
â”‚   â””â”€â”€ StoreBreakdownModel.swift
â”‚       â”œâ”€â”€ StoreBreakdown       # Store data by period
â”‚       â”œâ”€â”€ Category             # Category spending
â”‚       â””â”€â”€ StoreDataManager     # Aggregation logic
â”‚
â”œâ”€â”€ Services
â”‚   â”œâ”€â”€ AnthropicService.swift
â”‚   â”‚   â”œâ”€â”€ categorizeReceiptItems()  # Main API call
â”‚   â”‚   â”œâ”€â”€ buildCategorizationPrompt() # Prompt engineering
â”‚   â”‚   â”œâ”€â”€ sendRequest()        # HTTP request
â”‚   â”‚   â””â”€â”€ parseResponse()      # JSON parsing
â”‚   â”‚
â”‚   â””â”€â”€ ReceiptImportService.swift
â”‚       â”œâ”€â”€ importReceipt(from: UIImage)  # Process image
â”‚       â”œâ”€â”€ importReceipt(from: String)   # Process text
â”‚       â”œâ”€â”€ extractText()        # Vision OCR
â”‚       â”œâ”€â”€ detectStore()        # Keyword matching
â”‚       â””â”€â”€ extractDate()        # Date detection
â”‚
â”œâ”€â”€ Views
â”‚   â”œâ”€â”€ ReceiptScanView.swift
â”‚   â”‚   â”œâ”€â”€ Camera button
â”‚   â”‚   â”œâ”€â”€ Photo library button
â”‚   â”‚   â”œâ”€â”€ Text input button
â”‚   â”‚   â””â”€â”€ Processing indicator
â”‚   â”‚
â”‚   â”œâ”€â”€ ReceiptReviewView.swift
â”‚   â”‚   â”œâ”€â”€ Store info card
â”‚   â”‚   â”œâ”€â”€ Summary statistics
â”‚   â”‚   â”œâ”€â”€ Item list with swipe-to-delete
â”‚   â”‚   â””â”€â”€ Save/Cancel actions
â”‚   â”‚
â”‚   â”œâ”€â”€ ImagePicker.swift        # UIKit bridge for camera/photos
â”‚   â”œâ”€â”€ TextInputView.swift      # Text paste interface
â”‚   â””â”€â”€ OverviewView.swift       # Data visualization
â”‚
â””â”€â”€ Supporting Files
    â”œâ”€â”€ Info.plist               # Permissions
    â””â”€â”€ Assets.xcassets          # Images & colors
```

## State Management

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  TransactionManager                  â”‚
â”‚  (@StateObject in ContentView)      â”‚
â”‚                                      â”‚
â”‚  @Published var transactions         â”‚
â”‚                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â”‚ .environmentObject()
            â”‚
     â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚                              â”‚
     â†“                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ScanTab     â”‚              â”‚ ViewTab     â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚                            â”‚
       â†“                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ReceiptScanView  â”‚      â”‚ OverviewView    â”‚
â”‚                  â”‚      â”‚                 â”‚
â”‚ @EnvironmentObjectâ”‚     â”‚ @EnvironmentObjectâ”‚
â”‚ transactionManagerâ”‚     â”‚ transactionManagerâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## API Integration

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Anthropic Claude API Integration                           â”‚
â”‚                                                              â”‚
â”‚  Endpoint: https://api.anthropic.com/v1/messages           â”‚
â”‚  Model: claude-3-5-sonnet-20241022                         â”‚
â”‚  Max Tokens: 4096                                           â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ Request Structure                                   â”‚    â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”‚
â”‚  â”‚ {                                                  â”‚    â”‚
â”‚  â”‚   "model": "claude-3-5-sonnet-20241022",         â”‚    â”‚
â”‚  â”‚   "max_tokens": 4096,                            â”‚    â”‚
â”‚  â”‚   "messages": [                                  â”‚    â”‚
â”‚  â”‚     {                                            â”‚    â”‚
â”‚  â”‚       "role": "user",                           â”‚    â”‚
â”‚  â”‚       "content": "Analyze this receipt..."      â”‚    â”‚
â”‚  â”‚     }                                            â”‚    â”‚
â”‚  â”‚   ]                                              â”‚    â”‚
â”‚  â”‚ }                                                â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ Response Structure                                  â”‚    â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”‚
â”‚  â”‚ {                                                  â”‚    â”‚
â”‚  â”‚   "content": [                                    â”‚    â”‚
â”‚  â”‚     {                                             â”‚    â”‚
â”‚  â”‚       "type": "text",                            â”‚    â”‚
â”‚  â”‚       "text": "{\"items\": [...]}"               â”‚    â”‚
â”‚  â”‚     }                                             â”‚    â”‚
â”‚  â”‚   ]                                               â”‚    â”‚
â”‚  â”‚ }                                                 â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ Parsed Categories JSON                              â”‚    â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”‚
â”‚  â”‚ {                                                  â”‚    â”‚
â”‚  â”‚   "items": [                                      â”‚    â”‚
â”‚  â”‚     {                                             â”‚    â”‚
â”‚  â”‚       "itemName": "Bananas",                     â”‚    â”‚
â”‚  â”‚       "category": "Fresh Produce",               â”‚    â”‚
â”‚  â”‚       "quantity": 1,                             â”‚    â”‚
â”‚  â”‚       "amount": 2.50                             â”‚    â”‚
â”‚  â”‚     }                                             â”‚    â”‚
â”‚  â”‚   ]                                               â”‚    â”‚
â”‚  â”‚ }                                                 â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## User Journey

```
1. User opens app
   â””â†’ Sees 3 tabs: View, Scan, Dobby

2. User taps "Scan" tab
   â””â†’ Sees ReceiptScanView with 3 options

3. User chooses import method:
   â”œâ†’ Camera: Takes photo â†’ Vision OCR
   â”œâ†’ Photo Library: Selects image â†’ Vision OCR
   â””â†’ Text Paste: Pastes text directly

4. Processing happens:
   â”œâ†’ Store detection (keyword matching)
   â”œâ†’ Date extraction (if available)
   â””â†’ AI categorization (Anthropic API)

5. User sees ReceiptReviewView:
   â”œâ†’ Store name (with detection status)
   â”œâ†’ Date (editable)
   â”œâ†’ List of items with categories
   â”œâ†’ Total amount and statistics
   â””â†’ Can edit/delete items

6. User taps "Save":
   â”œâ†’ Transactions added to manager
   â””â†’ Success alert shown

7. User goes to "View" tab:
   â””â†’ Sees updated store breakdowns
       â”œâ†’ New transactions included
       â”œâ†’ Charts updated
       â””â†’ Can filter and sort
```

## Error Handling Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Error Types & Handling                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                         â”‚
â”‚  AnthropicError                         â”‚
â”‚  â”œâ”€â”€ invalidURL                         â”‚
â”‚  â”œâ”€â”€ invalidResponse                    â”‚
â”‚  â”œâ”€â”€ emptyResponse                      â”‚
â”‚  â”œâ”€â”€ invalidJSON                        â”‚
â”‚  â”œâ”€â”€ parsingError(Error)                â”‚
â”‚  â””â”€â”€ apiError(statusCode, message)      â”‚
â”‚      â””â†’ Show alert to user              â”‚
â”‚                                         â”‚
â”‚  ReceiptImportError                     â”‚
â”‚  â”œâ”€â”€ invalidImage                       â”‚
â”‚  â”œâ”€â”€ textRecognitionFailed              â”‚
â”‚  â”œâ”€â”€ noItemsFound                       â”‚
â”‚  â””â”€â”€ invalidReceiptFormat               â”‚
â”‚      â””â†’ Show alert to user              â”‚
â”‚                                         â”‚
â”‚  Network Errors                         â”‚
â”‚  â””â”€â”€ URLSession errors                  â”‚
â”‚      â””â†’ Check internet connection       â”‚
â”‚                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Categories & Icons

```
Category Mapping:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Category            â”‚ Icon             â”‚ SF Symbol  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Meat & Fish         â”‚ ğŸŸ               â”‚ fish.fill  â”‚
â”‚ Alcohol             â”‚ ğŸ·               â”‚ wineglass  â”‚
â”‚ Drinks (Soft/Soda)  â”‚ ğŸ’§               â”‚ drop.fill  â”‚
â”‚ Drinks (Water)      â”‚ ğŸ’§               â”‚ drop.fill  â”‚
â”‚ Household           â”‚ ğŸ                â”‚ house.fill â”‚
â”‚ Snacks & Sweets     â”‚ ğŸª               â”‚ cookie.fillâ”‚
â”‚ Fresh Produce       â”‚ ğŸ¥•               â”‚ carrot.fillâ”‚
â”‚ Dairy & Eggs        â”‚ ğŸ‚               â”‚ cake.fill  â”‚
â”‚ Ready Meals         â”‚ ğŸ´               â”‚ fork.knife â”‚
â”‚ Bakery              â”‚ ğŸ¥               â”‚ croissant  â”‚
â”‚ Pantry              â”‚ ğŸ—„ï¸               â”‚ cabinet    â”‚
â”‚ Personal Care       â”‚ âœ¨               â”‚ sparkles   â”‚
â”‚ Others              â”‚ ğŸ·ï¸               â”‚ tag.fill   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Performance Considerations

```
Operation              | Speed      | Notes
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Vision OCR            | ~1-2s      | Device dependent
Store Detection       | <0.01s     | Simple string search
Date Extraction       | <0.01s     | Regex based
Anthropic API Call    | ~3-5s      | Network dependent
JSON Parsing          | <0.01s     | Native Swift
UI Rendering          | <0.1s      | SwiftUI
Total Process Time    | ~4-7s      | Mostly API wait
```

## Security & Privacy

```
Data Layer:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  LOCAL (Device Only)                                â”‚
â”‚  â€¢ Receipt images                                   â”‚
â”‚  â€¢ Transaction data                                 â”‚
â”‚  â€¢ User preferences                                 â”‚
â”‚  â€¢ No iCloud sync (can be added)                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ (Only extracted text sent)
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  CLOUD (Anthropic API)                              â”‚
â”‚  â€¢ Receipt text only                                â”‚
â”‚  â€¢ No images sent                                   â”‚
â”‚  â€¢ No personal identifiers                          â”‚
â”‚  â€¢ Not stored by Anthropic (per policy)            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

This architecture provides:
- âœ… Clear separation of concerns
- âœ… Modular and testable code
- âœ… Reactive state management
- âœ… Error handling at every layer
- âœ… Privacy-focused design
- âœ… iOS design patterns
